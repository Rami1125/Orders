<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת VIP ח. סבן</title>
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: האפליקציה בנויה כ-Single Page Application (SPA) עטופה במסגרת ויזואלית של מכשיר נייד (Samsung S25) לחווית פרימיום. המבנה נועד לרכז את כל המידע והפעולות החשובות ללקוח במקום אחד נגיש. הניווט מתבצע דרך תפריט צד (Hamburger) המאפשר מעבר חלק בין המסכים המרכזיים: מסך ראשי (מפה וסטטוס), היסטוריית הזמנות, חנות דיגיטלית וכלים נוספים. זרימת המשתמש מתחילה בכניסה עם מספר טלפון, המובילה למסך הראשי המציג תמונת מצב ויזואלית של הפרויקטים. תהליך ההזמנה מובנה כ"אשף" (Wizard) חכם בן מספר שלבים, כדי להדריך את המשתמש, למנוע טעויות ולהטמיע פיצ'רים חכמים כמו בדיקת כתובות והצגת הנחיות עירייה. מבנה זה נבחר כדי ליצור חוויה אינטואיטיבית, המדמה אפליקציה ייעודית, וממקדת את המשתמש במשימות העיקריות שלו ביעילות. -->
    <!-- Visualization & Content Choices: 
        - מפת פרויקטים: מטרה - הצגה גיאוגרפית של הפעילות. ייצוג - Canvas אינטראקטיבי. אינטראקציה - לחיצה על סיכה מציגה חלון Popup עם פרטי פרויקט. הצדקה - מספק תמונה ויזואלית ומהירה, ללא תלות בספריות חיצוניות כבדות.
        - סטטוס הזמנות: מטרה - הצגת מצב עדכני והתראות. ייצוג - רשימת קלפים עם עיצוב מותנה (צבעים, אנימציית הבהוב לחריגות). אינטראקציה - לחיצה לצפייה בפרטים מלאים, סינון. הצדקה - תקשורת ברורה של מידע חשוב ודחוף.
        - אשף הזמנה: מטרה - פישוט תהליך מורכב. ייצוג - טופס רב-שלבי עם סרגל התקדמות. אינטראקציה - בחירה ויזואלית של פעולות (כפתורים עם אייקונים), סליידר לתאריך/שעה. הצדקה - מוריד עומס קוגניטיבי ומונע טעויות.
        - הנחיות עירייה: מטרה - מתן מידע קריטי בזמן אמת. ייצוג - אזור תוכן דינאמי המופיע בטופס ההזמנה. אינטראקציה - אוטומטית לאחר בחירת עיר. הצדקה - פיצ'ר בעל ערך מוסף גבוה, מונע קנסות ותקלות תפעוליות.
        - דוחות: מטרה - ניתוח היסטוריית פעילות. ייצוג - טבלה דינאמית עם חיפוש וסינון + גרף מבוסס Chart.js. אינטראקציה - סינון לפי תאריכים/סוג, חיפוש טקסט. הצדקה - מאפשר ללקוח לקבל תובנות על הפעילות שלו.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Rubik', sans-serif; background-color: #f0f2f5; }
        .s25-frame {
            background: #1a1a1a;
            border-radius: 40px;
            padding: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 0 8px #000;
            transition: all 0.5s ease;
            margin: 2vh auto;
        }
        .s25-screen {
            background: #ffffff;
            border-radius: 28px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        @media (min-width: 1024px) {
            .s25-frame { width: 95vw; max-width: 1200px; height: 85vh; padding: 15px; }
            .s25-screen { flex-direction: row; }
        }
        @media (max-width: 1023px) {
            .s25-frame { width: 95vw; max-width: 420px; height: 96vh; }
            .s25-screen { width: 100%; height: 100%; }
        }
        .glassmorphism {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .nav-item.active { background-color: #e0f2fe; color: #0c4a6e; }
        .blinking-light { animation: blink 1.5s infinite; }
        @keyframes blink { 50% { background-color: rgba(254, 202, 202, 0.7); } }
        .page { display: none; }
        .page.active { display: block; }
        .wizard-step { display: none; }
        .wizard-step.active { display: block; }
        .progress-step.active { background-color: #2563eb; color: white; }
        .progress-step.completed { background-color: #16a34a; color: white; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen bg-gray-200">

    <div class="s25-frame">
        <div class="s25-screen" id="app-container">

            <!-- App content goes here -->
            <main id="main-content" class="flex-1 flex flex-col h-full overflow-y-auto">
                
                <!-- Login Page -->
                <div id="login-page" class="page active flex flex-col justify-center items-center h-full p-8 bg-gray-50 text-center">
                    <i class="fas fa-truck-moving text-6xl text-blue-600 mb-4"></i>
                    <h1 class="text-3xl font-bold text-gray-800">ח. סבן</h1>
                    <p class="text-gray-500 mb-8">מערכת ניהול VIP</p>
                    <div class="w-full max-w-sm">
                        <label for="phone-input" class="block text-right mb-2 text-gray-600">מספר טלפון</label>
                        <input type="tel" id="phone-input" class="w-full p-3 border border-gray-300 rounded-lg text-center" placeholder="050-1234567">
                        <button id="login-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mt-4 hover:bg-blue-700 transition-colors">
                            כניסה למערכת
                        </button>
                    </div>
                </div>

                <!-- Main App Interface (hidden initially) -->
                <div id="app-interface" class="hidden h-full lg:flex">
                    <!-- Sidebar Navigation -->
                    <nav id="sidebar" class="bg-white w-64 p-4 border-l border-gray-200 flex-shrink-0 lg:flex flex-col hidden">
                        <div class="flex items-center mb-6">
                             <img id="user-avatar-sidebar" src="" alt="Avatar" class="w-12 h-12 rounded-full ml-3">
                             <div>
                                 <h2 id="user-name-sidebar" class="font-bold text-lg"></h2>
                                 <span class="text-sm text-gray-500">לקוח VIP</span>
                             </div>
                        </div>
                        <ul class="space-y-2 flex-1">
                            <li><a href="#" data-page="dashboard" class="nav-item flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100 active"><i class="fas fa-map-marked-alt w-6 ml-3"></i> מסך ראשי</a></li>
                            <li><a href="#" data-page="orders" class="nav-item flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100"><i class="fas fa-history w-6 ml-3"></i> ההזמנות שלי</a></li>
                            <li><a href="#" data-page="store" class="nav-item flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100"><i class="fas fa-store w-6 ml-3"></i> חנות דיגיטלית</a></li>
                            <li><a href="#" data-page="reports" class="nav-item flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100"><i class="fas fa-chart-pie w-6 ml-3"></i> דוחות</a></li>
                            <li><a href="#" data-page="faq" class="nav-item flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100"><i class="fas fa-question-circle w-6 ml-3"></i> שאלות ותשובות</a></li>
                            <li><a href="#" data-page="chat" class="nav-item flex items-center p-3 rounded-lg text-gray-700 hover:bg-gray-100"><i class="fas fa-comments w-6 ml-3"></i> צ'אט</a></li>
                        </ul>
                        <div>
                             <a href="#" id="logout-btn" class="nav-item flex items-center p-3 rounded-lg text-red-600 hover:bg-red-50"><i class="fas fa-sign-out-alt w-6 ml-3"></i> יציאה</a>
                        </div>
                    </nav>

                    <!-- Page Content -->
                    <div class="flex-1 flex flex-col overflow-hidden">
                        <!-- Header -->
                        <header class="bg-white p-4 border-b border-gray-200 flex items-center justify-between lg:hidden">
                            <button id="hamburger-btn" class="text-gray-600 text-2xl"><i class="fas fa-bars"></i></button>
                             <h1 id="page-title" class="text-xl font-bold">מסך ראשי</h1>
                            <div class="w-8"></div>
                        </header>
                        
                        <!-- Pages Wrapper -->
                        <div class="flex-1 overflow-y-auto bg-gray-50">
                            <!-- Dashboard Page -->
                            <div id="dashboard-page" class="page active p-4">
                               <div id="overdue-banner" class="hidden bg-red-100 border-r-4 border-red-500 text-red-700 p-4 rounded-lg mb-4 cursor-pointer">
                                    <p class="font-bold">שימו לב!</p>
                                    <p>זוהתה חריגה בזמני השכירות של <span id="overdue-count"></span> מכולות. לחצו לסינון.</p>
                                </div>
                                <h2 class="text-2xl font-bold mb-4">פרויקטים פעילים</h2>
                                <div class="bg-white p-2 rounded-lg shadow">
                                     <canvas id="map-canvas" height="300"></canvas>
                                </div>
                                <button id="new-order-btn-main" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg mt-4 hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-plus ml-2"></i> הזמנה חדשה
                                </button>
                            </div>
                            
                            <!-- Orders Page -->
                            <div id="orders-page" class="page p-4">
                                <h2 class="text-2xl font-bold mb-4">היסטוריית הזמנות</h2>
                                <div id="orders-list" class="space-y-3"></div>
                            </div>
                            
                            <!-- Store Page -->
                            <div id="store-page" class="page p-4">
                                <h2 class="text-2xl font-bold mb-4">חנות דיגיטלית</h2>
                            </div>

                            <!-- Reports Page -->
                            <div id="reports-page" class="page p-4">
                                <h2 class="text-2xl font-bold mb-4">דוחות</h2>
                            </div>

                            <!-- FAQ Page -->
                            <div id="faq-page" class="page p-4">
                                <h2 class="text-2xl font-bold mb-4">שאלות ותשובות</h2>
                            </div>

                             <!-- Chat Page -->
                            <div id="chat-page" class="page p-4">
                                <h2 class="text-2xl font-bold mb-4">צ'אט</h2>
                            </div>
                            
                             <!-- New Order Wizard Page -->
                            <div id="new-order-wizard-page" class="page p-4">
                                <h2 class="text-2xl font-bold mb-4">יצירת הזמנה חדשה</h2>
                                <!-- Progress Bar -->
                                <div class="flex justify-between items-center mb-6 text-sm">
                                    <div id="step-1-indicator" class="progress-step active w-1/3 text-center py-2 rounded-r-lg bg-gray-200">פרטים</div>
                                    <div id="step-2-indicator" class="progress-step w-1/3 text-center py-2 bg-gray-200">כתובת</div>
                                    <div id="step-3-indicator" class="progress-step w-1/3 text-center py-2 rounded-l-lg bg-gray-200">אישור</div>
                                </div>

                                <!-- Wizard Steps -->
                                <div id="wizard-content">
                                    <!-- Step 1: Order Details -->
                                    <div id="wizard-step-1" class="wizard-step active">
                                        <h3 class="font-semibold text-lg mb-2">שלב 1: פרטי הזמנה</h3>
                                        <!-- Project Selection -->
                                        <div class="mb-4">
                                            <label for="project-select" class="block mb-1">בחירת פרויקט</label>
                                            <select id="project-select" class="w-full p-2 border rounded-lg"></select>
                                        </div>
                                        <!-- Action Type -->
                                        <div class="mb-4">
                                            <label class="block mb-1">מהות ההזמנה</label>
                                            <div class="grid grid-cols-3 gap-2 text-center" id="action-type-selector">
                                                <button data-action="הורדה" class="p-3 border rounded-lg hover:bg-blue-50"><i class="fas fa-arrow-down block mb-1"></i>הורדה</button>
                                                <button data-action="החלפה" class="p-3 border rounded-lg hover:bg-blue-50"><i class="fas fa-exchange-alt block mb-1"></i>החלפה</button>
                                                <button data-action="העלאה" class="p-3 border rounded-lg hover:bg-blue-50"><i class="fas fa-arrow-up block mb-1"></i>העלאה</button>
                                                <button data-action="פינוי במקום" class="p-3 border rounded-lg hover:bg-blue-50"><i class="fas fa-trash-alt block mb-1"></i>פינוי</button>
                                                <button data-action="הזזה" class="p-3 border rounded-lg hover:bg-blue-50"><i class="fas fa-arrows-alt block mb-1"></i>הזזה</button>
                                                <button data-action="חומרי בניין" class="p-3 border rounded-lg hover:bg-blue-50"><i class="fas fa-cubes block mb-1"></i>חומרים</button>
                                            </div>
                                        </div>
                                        <!-- Date & Time -->
                                        <div class="mb-4">
                                            <label for="delivery-date" class="block mb-1">מועד אספקה</label>
                                            <input type="date" id="delivery-date" class="w-full p-2 border rounded-lg">
                                        </div>
                                        <button id="wizard-next-1" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg">המשך לשלב הבא</button>
                                    </div>
                                    
                                    <!-- Step 2: Address & Guidelines -->
                                    <div id="wizard-step-2" class="wizard-step">
                                        <h3 class="font-semibold text-lg mb-2">שלב 2: כתובת והנחיות</h3>
                                         <div class="grid grid-cols-2 gap-4 mb-4">
                                             <input type="text" id="city-input" placeholder="עיר" class="p-2 border rounded-lg col-span-2">
                                             <input type="text" id="street-input" placeholder="רחוב" class="p-2 border rounded-lg">
                                             <input type="text" id="house-number-input" placeholder="מספר" class="p-2 border rounded-lg">
                                         </div>
                                         <div id="municipal-guidelines" class="hidden p-3 mb-4 border rounded-lg bg-yellow-50"></div>
                                        <button id="wizard-next-2" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg">המשך לאישור</button>
                                        <button id="wizard-back-2" class="w-full bg-gray-300 text-gray-800 font-bold py-3 rounded-lg mt-2">חזרה</button>
                                    </div>

                                    <!-- Step 3: Confirmation -->
                                    <div id="wizard-step-3" class="wizard-step">
                                        <h3 class="font-semibold text-lg mb-2">שלב 3: סיכום ואישור</h3>
                                        <div id="order-summary" class="p-4 rounded-lg glassmorphism mb-4 space-y-2"></div>
                                        <div class="flex items-center mb-4">
                                            <input type="checkbox" id="confirm-checkbox" class="ml-2">
                                            <label for="confirm-checkbox">אני מאשר את פרטי ההזמנה</label>
                                        </div>
                                        <button id="submit-order-btn" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg disabled:bg-gray-400" disabled>שליחת הזמנה</button>
                                        <button id="wizard-back-3" class="w-full bg-gray-300 text-gray-800 font-bold py-3 rounded-lg mt-2">חזרה</button>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const App = {
            state: {
                currentUser: null,
                currentPage: 'login',
                clients: [
                    {"מזהה לקוח":"601064","שם לקוח":"אורניל-כללי","מספר טלפון":"0508860896","סיסמה":"סבו","קישור לאווטאר":"https://img.icons8.com/?size=100&id=20750&format=png&color=000000"},
                    {"מזהה לקוח":"1001","שם לקוח":"אורניל-אשר לוי","מספר טלפון":"050886494","סיסמה":"סבן","קישור לאווטאר":"https://img.icons8.com/?size=100&id=O9K5DaypaVKw&format=png&color=000000"},
                    {"מזהה לקוח":"1002","שם לקוח":"אבי","מספר טלפון":"0508861080","סיסמה":"סבן","קישור לאווטאר":"https://img.icons8.com/?size=100&id=7WwZau6gMj6x&format=png&color=000000"}
                ],
                projects: [
                    {"מזהה פרויקט":"P-101","מזהה לקוח":"601064","שם פרויקט":"פרויקט הדגל","כתובת":"הסתדרות 29, רעננה", lat: 32.1836, lng: 34.8724},
                    {"מזהה פרויקט":"P-102","מזהה לקוח":"601064","שם פרויקט":"בניין מגורים הוד","כתובת":"ויצמן 2, הוד השרון", lat: 32.1540, lng: 34.8854},
                     {"מזהה פרויקט":"P-201","מזהה לקוח":"1001","שם פרויקט":"שיפוץ משרדים","כתובת":"אחוזה 120, רעננה", lat: 32.1842, lng: 34.8711},
                ],
                orders: [
                    {"תעודה":"ORD-1001","מזהה לקוח":"601064","סוג פעולה":"החלפה","סטטוס":"בביצוע","תאריך הזמנה":"2025-09-03", "כתובת": "הסתדרות 29, רעננה", "ימים שעברו": 2},
                    {"תעודה":"ORD-1002","מזהה לקוח":"601064","סוג פעולה":"הורדה","סטטוס":"הושלם","תאריך הזמנה":"2025-08-25", "כתובת": "ויצמן 2, הוד השרון", "ימים שעברו": 10},
                    {"תעודה":"ORD-1003","מזהה לקוח":"601064","סוג פעולה":"העלאה","סטטוס":"ממתין לביצוע","תאריך הזמנה":"2025-09-04", "כתובת": "הסתדרות 29, רעננה", "ימים שעברו": 12, "חריגה": true},
                    {"תעודה":"ORD-1004","מזהה לקוח":"1001","סוג פעולה":"הורדה","סטטוס":"בביצוע","תאריך הזמנה":"2025-09-02", "כתובת": "אחוזה 120, רעננה", "ימים שעברו": 3},
                ],
                newOrder: {},
            },
            init() {
                this.bindEvents();
                this.checkAuth();
            },
            checkAuth() {
                const userPhone = sessionStorage.getItem('userPhone');
                if (userPhone) {
                    this.login(userPhone);
                }
            },
            bindEvents() {
                document.getElementById('login-btn').addEventListener('click', () => {
                    const phone = document.getElementById('phone-input').value.replace(/-/g, '');
                    this.login(phone);
                });

                document.getElementById('logout-btn').addEventListener('click', () => this.logout());
                document.getElementById('new-order-btn-main').addEventListener('click', () => this.navigateTo('new-order-wizard'));
                
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.navigateTo(item.dataset.page);
                    });
                });
                
                document.getElementById('wizard-next-1').addEventListener('click', () => this.handleWizardStep(1, 2));
                document.getElementById('wizard-back-2').addEventListener('click', () => this.handleWizardStep(2, 1));
                document.getElementById('wizard-next-2').addEventListener('click', () => this.handleWizardStep(2, 3));
                document.getElementById('wizard-back-3').addEventListener('click', () => this.handleWizardStep(3, 2));

                document.getElementById('confirm-checkbox').addEventListener('change', (e) => {
                    document.getElementById('submit-order-btn').disabled = !e.target.checked;
                });
            },
            handleWizardStep(from, to) {
                 if (from === 1) {
                    const selectedProject = this.state.projects.find(p => p['מזהה פרויקט'] === document.getElementById('project-select').value);
                    const selectedAction = document.querySelector('#action-type-selector button.bg-blue-200')?.dataset.action;
                    if (!selectedProject || !selectedAction) {
                        alert('יש לבחור פרויקט ומהות הזמנה');
                        return;
                    }
                    this.state.newOrder.project = selectedProject;
                    this.state.newOrder.action = selectedAction;
                    this.state.newOrder.date = document.getElementById('delivery-date').value;
                    document.getElementById('city-input').value = selectedProject.כתובת.split(',')[1].trim();
                    document.getElementById('street-input').value = selectedProject.כתובת.split(' ')[0] + ' ' + selectedProject.כתובת.split(' ')[1];
                    document.getElementById('house-number-input').value = selectedProject.כתובת.split(',')[0].replace(/\D/g,'');
                }
                
                if (from === 2 && to === 3) {
                     this.renderOrderSummary();
                }

                document.getElementById(`wizard-step-${from}`).classList.remove('active');
                document.getElementById(`wizard-step-${to}`).classList.add('active');
                
                document.getElementById(`step-${from}-indicator`).classList.remove('active');
                document.getElementById(`step-${from}-indicator`).classList.add('completed');
                document.getElementById(`step-${to}-indicator`).classList.add('active');
            },
            login(phone) {
                const user = this.state.clients.find(c => c['מספר טלפון'] === phone);
                if (user) {
                    this.state.currentUser = user;
                    sessionStorage.setItem('userPhone', phone);
                    document.getElementById('login-page').classList.remove('active');
                    document.getElementById('app-interface').classList.remove('hidden');
                    document.getElementById('app-interface').classList.add('flex');
                    this.setupUI();
                    this.navigateTo('dashboard');
                } else {
                    alert('מספר טלפון לא קיים במערכת');
                }
            },
            logout() {
                this.state.currentUser = null;
                sessionStorage.removeItem('userPhone');
                document.getElementById('app-interface').classList.add('hidden');
                document.getElementById('app-interface').classList.remove('flex');
                document.getElementById('login-page').classList.add('active');
            },
            setupUI() {
                document.getElementById('user-name-sidebar').textContent = this.state.currentUser['שם לקוח'];
                document.getElementById('user-avatar-sidebar').src = this.state.currentUser['קישור לאווטאר'];
                this.renderDashboard();
            },
            navigateTo(pageId) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(`${pageId}-page`).classList.add('active');

                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.page === pageId) {
                        item.classList.add('active');
                    }
                });
                
                if (pageId === 'dashboard') this.renderDashboard();
                if (pageId === 'orders') this.renderOrders();
                if (pageId === 'new-order-wizard') this.renderNewOrderWizard();
            },
            renderDashboard() {
                this.drawMap();
                const overdueOrders = this.state.orders.filter(o => o['מזהה לקוח'] === this.state.currentUser['מזהה לקוח'] && o.חריגה);
                if (overdueOrders.length > 0) {
                    document.getElementById('overdue-banner').classList.remove('hidden');
                    document.getElementById('overdue-count').textContent = overdueOrders.length;
                } else {
                    document.getElementById('overdue-banner').classList.add('hidden');
                }
            },
            renderOrders() {
                const userOrders = this.state.orders.filter(o => o['מזהה לקוח'] === this.state.currentUser['מזהה לקוח']);
                const listEl = document.getElementById('orders-list');
                listEl.innerHTML = '';
                if (userOrders.length === 0) {
                    listEl.innerHTML = '<p>לא נמצאו הזמנות.</p>';
                    return;
                }
                userOrders.forEach(order => {
                    const statusColors = { "בביצוע": "blue", "הושלם": "green", "ממתין לביצוע": "yellow" };
                    const actionColors = { "הורדה": "green", "החלפה": "yellow", "העלאה": "blue", "הזזה": "purple" };
                    
                    const card = document.createElement('div');
                    card.className = `bg-white p-4 rounded-lg shadow-sm border-r-4 ${order.חריגה ? 'blinking-light' : ''}`;
                    card.style.borderRightColor = actionColors[order['סוג פעולה']] || 'gray';
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-bold">${order['סוג פעולה']} - ${order['כתובת']}</p>
                                <p class="text-sm text-gray-500">תעודה: ${order['תעודה']}</p>
                            </div>
                            <span class="text-xs font-semibold text-white px-2 py-1 rounded-full bg-${statusColors[order.סטטוס]}-500">${order.סטטוס}</span>
                        </div>
                        <div class="text-sm text-gray-600 mt-2">
                            <span>תאריך: ${order['תאריך הזמנה']}</span> | 
                            <span>ימים באתר: ${order['ימים שעברו']}</span>
                        </div>
                    `;
                    listEl.appendChild(card);
                });
            },
            renderNewOrderWizard() {
                const projectSelect = document.getElementById('project-select');
                projectSelect.innerHTML = '<option value="">בחר פרויקט...</option>';
                const userProjects = this.state.projects.filter(p => p['מזהה לקוח'] === this.state.currentUser['מזהה לקוח']);
                userProjects.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p['מזהה פרויקט'];
                    option.textContent = `${p['שם פרויקט']} (${p.כתובת})`;
                    projectSelect.appendChild(option);
                });

                document.querySelectorAll('#action-type-selector button').forEach(button => {
                     button.addEventListener('click', () => {
                        document.querySelectorAll('#action-type-selector button').forEach(btn => btn.classList.remove('bg-blue-200', 'border-blue-500'));
                        button.classList.add('bg-blue-200', 'border-blue-500');
                    });
                });

                document.getElementById('delivery-date').valueAsDate = new Date();
                
                 // Reset wizard
                this.state.newOrder = {};
                this.handleWizardStep(3,1);
                this.handleWizardStep(2,1);
                document.querySelectorAll('.wizard-step').forEach(s => s.classList.remove('active'));
                document.getElementById('wizard-step-1').classList.add('active');
                document.querySelectorAll('.progress-step').forEach(ps => ps.classList.remove('active', 'completed'));
                document.getElementById('step-1-indicator').classList.add('active');
                document.getElementById('confirm-checkbox').checked = false;
                document.getElementById('submit-order-btn').disabled = true;

            },
            renderOrderSummary() {
                 const summaryEl = document.getElementById('order-summary');
                 summaryEl.innerHTML = `
                    <p><strong>פרויקט:</strong> ${this.state.newOrder.project['שם פרויקט']}</p>
                    <p><strong>כתובת:</strong> ${this.state.newOrder.project.כתובת}</p>
                    <p><strong>פעולה:</strong> ${this.state.newOrder.action}</p>
                    <p><strong>תאריך:</strong> ${this.state.newOrder.date}</p>
                 `;
            },
            drawMap() {
                const canvas = document.getElementById('map-canvas');
                const ctx = canvas.getContext('2d');
                const userProjects = this.state.projects.filter(p => p['מזהה לקוח'] === this.state.currentUser['מזהה לקוח']);
                
                const bounds = {
                    minLat: Math.min(...userProjects.map(p => p.lat)),
                    maxLat: Math.max(...userProjects.map(p => p.lat)),
                    minLng: Math.min(...userProjects.map(p => p.lng)),
                    maxLng: Math.max(...userProjects.map(p => p.lng)),
                };
                
                const latRange = bounds.maxLat - bounds.minLat || 0.1;
                const lngRange = bounds.maxLng - bounds.minLng || 0.1;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#eef2ff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                userProjects.forEach(project => {
                    const x = (project.lng - bounds.minLng) / lngRange * (canvas.width - 40) + 20;
                    const y = (bounds.maxLat - project.lat) / latRange * (canvas.height - 40) + 20;
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 8, 0, 2 * Math.PI, false);
                    ctx.fillStyle = '#3b82f6';
                    ctx.fill();
                    ctx.lineWidth = 2;
                    ctx.strokeStyle = '#ffffff';
                    ctx.stroke();

                    ctx.fillStyle = '#1e3a8a';
                    ctx.font = '12px Rubik';
                    ctx.textAlign = 'center';
                    ctx.fillText(project['שם פרויקט'], x, y + 20);
                });
            }
        };

        App.init();
    });
    </script>
</body>
</html>
